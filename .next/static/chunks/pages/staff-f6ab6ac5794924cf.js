(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[559],{1688:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/staff",function(){return a(6241)}])},6241:function(e,s,a){"use strict";a.r(s);var c=a(5893),l=a(645),i=a(7294),r=a(4155);s.default=()=>{var e,s;let[a,t]=(0,i.useState)("testing"),[d,n]=(0,i.useState)([]),[x,j]=(0,i.useState)("factories"),[m,o]=(0,i.useState)([]),[b,h]=(0,i.useState)(!1),[v]=(0,i.useState)(r.env.REACT_APP_API_URL||"http://localhost:3001/api"),N=[{name:"factories",label:"工廠資料",icon:"\uD83C\uDFED"},{name:"equipment",label:"設備資料",icon:"⚙️"},{name:"users",label:"用戶資料",icon:"\uD83D\uDC64"},{name:"production_data",label:"生產數據",icon:"\uD83D\uDCCA"},{name:"alerts",label:"警報記錄",icon:"⚠️"},{name:"energy_consumption",label:"能耗數據",icon:"⚡"},{name:"maintenance_records",label:"維護記錄",icon:"\uD83D\uDD27"}];(0,i.useEffect)(()=>{u()},[]);let u=async()=>{t("testing"),n([]);try{console.log("開始資料庫連線測試...");let e=await fetch("".concat(v,"/database/test"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP Error: ".concat(e.status," ").concat(e.statusText));let s=await e.json();console.log("連線測試結果:",s),s.success?(t("success"),n(s.tests||[])):(t("error"),n([{test:"連線失敗",status:"error",message:s.error||"未知錯誤",icon:"❌"}]))}catch(e){console.error("連線測試錯誤:",e),t("error"),n([{test:"網路連線錯誤",status:"error",message:"無法連接到伺服器: ".concat(e.message),icon:"\uD83D\uDD0C"}])}},p=async e=>{h(!0);try{console.log("獲取表格數據: ".concat(e));let s=await fetch("".concat(v,"/database/table/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw Error("HTTP Error: ".concat(s.status," ").concat(s.statusText));let a=await s.json();console.log("".concat(e," 數據:"),a),a.success?o(a.data||[]):(console.error("獲取數據失敗:",a.error),o([]))}catch(e){console.error("獲取數據錯誤:",e),o([])}finally{h(!1)}},g=e=>{switch(e){case"error":case"critical":return"alert-high";case"warning":return"alert-medium";default:return"alert-low"}};return(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac main-content",children:[(0,c.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto"},className:"jsx-279312e5b42522ac",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac page-header",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac page-breadcrumb",children:[(0,c.jsx)("span",{className:"jsx-279312e5b42522ac breadcrumb-item",children:"系統管理"}),(0,c.jsx)("span",{className:"jsx-279312e5b42522ac breadcrumb-separator"}),(0,c.jsx)("span",{className:"jsx-279312e5b42522ac breadcrumb-item",children:"資料庫管理"}),(0,c.jsx)("span",{className:"jsx-279312e5b42522ac breadcrumb-separator"}),(0,c.jsx)("span",{className:"jsx-279312e5b42522ac",children:"連線測試"})]}),(0,c.jsx)("h1",{className:"jsx-279312e5b42522ac page-title",children:"SQL Server 資料庫測試"}),(0,c.jsx)("p",{className:"jsx-279312e5b42522ac page-subtitle",children:"測試與 SQL Server 資料庫的連線狀態並查看範例數據"})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card mb-4 card-primary",children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-body",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac flex items-center",children:[(0,c.jsx)("span",{style:{fontSize:"1.2rem",marginRight:"var(--space-2)"},className:"jsx-279312e5b42522ac",children:"\uD83D\uDD17"}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac",children:[(0,c.jsx)("h4",{className:"jsx-279312e5b42522ac text-primary font-semibold",children:"API 連線設定"}),(0,c.jsxs)("p",{className:"jsx-279312e5b42522ac text-sm text-secondary",children:["後端API地址: ",(0,c.jsx)("code",{style:{backgroundColor:"var(--primary-100)",padding:"var(--space-1) var(--space-2)",borderRadius:"var(--radius-sm)",fontFamily:"monospace"},className:"jsx-279312e5b42522ac",children:v})]})]})]})})}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card mb-4",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card-header",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac",children:[(0,c.jsx)("h2",{className:"jsx-279312e5b42522ac card-title",children:"SQL Server 連線狀態"}),(0,c.jsx)("p",{className:"jsx-279312e5b42522ac card-subtitle",children:"Microsoft SQL Server 數據庫連線測試"})]}),(0,c.jsx)("button",{onClick:u,disabled:"testing"===a,className:"jsx-279312e5b42522ac "+"btn ".concat("testing"===a?"btn-secondary":"btn-primary"),children:"testing"===a?"測試中...":"重新測試"})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card-body",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac stat-card mb-4",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-icon",children:"success"===a?"✅":"error"===a?"❌":"\uD83D\uDD04"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-value text-lg",children:"success"===a?"資料庫連線正常":"error"===a?"資料庫連線失敗":"正在測試連線..."}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-label",children:"success"===a?"所有測試項目通過，系統運行正常":"error"===a?"請檢查資料庫設定和網路連線":"正在執行連線測試，請稍候..."}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac "+"stat-change ".concat("success"===a?"positive":"negative"),children:"success"===a?"運行正常":"error"===a?"需要檢查":"測試中"})]}),d.length>0&&(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac",children:[(0,c.jsx)("h4",{className:"jsx-279312e5b42522ac text-lg font-semibold text-primary mb-3",children:"測試詳情"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-panel",children:d.map((e,s)=>(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac "+"alert-item ".concat(g(e.status)," slide-in-left"),children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-header",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-title",children:[e.icon," ",e.test]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac "+"alert-level ".concat("success"===e.status?"low":"high"),children:"success"===e.status?"正常":"異常"})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-content",children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-factory",children:e.message})})]},s))})]})]})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-header",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac",children:[(0,c.jsx)("h2",{className:"jsx-279312e5b42522ac card-title",children:"資料表瀏覽"}),(0,c.jsx)("p",{className:"jsx-279312e5b42522ac card-subtitle",children:"瀏覽系統中的各種資料表"})]})}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card-body",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac mb-4",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac grid grid-cols-2 grid-gap-sm",children:N.map(e=>(0,c.jsx)("button",{onClick:()=>{j(e.name),p(e.name)},style:{textAlign:"center",border:x===e.name?"2px solid var(--accent-blue)":void 0},className:"jsx-279312e5b42522ac "+"factory-card ".concat(x===e.name?"card-primary":""),children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac factory-header",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac factory-name text-center",children:[(0,c.jsx)("span",{style:{fontSize:"1.8rem",display:"block",marginBottom:"var(--space-2)"},className:"jsx-279312e5b42522ac",children:e.icon}),e.label]})})},e.name))}),x&&(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-primary mt-4",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card-body",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac flex items-center mb-2",children:[(0,c.jsx)("span",{style:{fontSize:"1.2rem",marginRight:"var(--space-2)"},className:"jsx-279312e5b42522ac",children:null===(e=N.find(e=>e.name===x))||void 0===e?void 0:e.icon}),(0,c.jsx)("h3",{className:"jsx-279312e5b42522ac text-primary font-semibold",children:null===(s=N.find(e=>e.name===x))||void 0===s?void 0:s.label})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac text-sm text-secondary",children:["表格名稱: ",(0,c.jsx)("code",{style:{backgroundColor:"var(--primary-100)",padding:"var(--space-1) var(--space-2)",borderRadius:"var(--radius-sm)",fontFamily:"monospace"},className:"jsx-279312e5b42522ac",children:x}),m.length>0&&(0,c.jsxs)("span",{className:"jsx-279312e5b42522ac ml-4",children:["共 ",m.length," 筆記錄"]})]})]})})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac block mobile-view",children:b?(0,c.jsx)("div",{className:"loading",children:(0,c.jsx)("div",{className:"spinner"})}):0===m.length?(0,c.jsxs)("div",{className:"text-center",style:{padding:"var(--space-8)"},children:[(0,c.jsx)("div",{style:{fontSize:"3rem",marginBottom:"var(--space-4)"},children:"\uD83D\uDCDD"}),(0,c.jsx)("p",{className:"text-secondary",children:"選擇一個表格來查看數據"})]}):(0,c.jsx)("div",{className:"grid grid-cols-1 grid-gap-sm",children:m.map((e,s)=>(0,c.jsxs)("div",{className:"factory-card fade-in",children:[(0,c.jsxs)("div",{className:"factory-header",children:[(0,c.jsxs)("div",{className:"factory-name",children:["記錄 #",e.id||e.factory_id||e.equipment_id||e.user_id||s+1]}),e.status&&(0,c.jsx)("span",{className:"status-badge ".concat("online"===e.status||"running"===e.status||"completed"===e.status||"active"===e.status?"status-online":"offline"===e.status||"error"===e.status||"resolved"===e.status?"status-offline":"status-maintenance"),children:e.status})]}),(0,c.jsx)("div",{className:"factory-metrics",children:Object.entries(e).filter(e=>{let[s]=e;return!["id","factory_id","equipment_id","user_id","status"].includes(s)}).slice(0,6).map(e=>{let[s,a]=e;return(0,c.jsxs)("div",{className:"metric",children:[(0,c.jsx)("div",{className:"metric-label",children:s.replace(/_/g," ")}),(0,c.jsx)("div",{className:"metric-value text-sm",children:null==a?"-":a.toString()})]},s)})})]},s))})}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac hidden desktop-view",children:(()=>{if(b)return(0,c.jsx)("div",{className:"loading",children:(0,c.jsx)("div",{className:"spinner"})});if(0===m.length)return(0,c.jsxs)("div",{className:"text-center",style:{padding:"var(--space-8)"},children:[(0,c.jsx)("div",{style:{fontSize:"3rem",marginBottom:"var(--space-4)"},children:"\uD83D\uDCDD"}),(0,c.jsx)("p",{className:"text-secondary",children:"選擇一個表格來查看數據"})]});let e=Object.keys(m[0]);return(0,c.jsx)("div",{style:{overflowX:"auto"},children:(0,c.jsxs)("table",{className:"data-table",children:[(0,c.jsx)("thead",{children:(0,c.jsx)("tr",{children:e.map(e=>(0,c.jsx)("th",{children:e.replace(/_/g," ").toUpperCase()},e))})}),(0,c.jsx)("tbody",{children:m.map((s,a)=>(0,c.jsx)("tr",{className:"fade-in",children:e.map(e=>(0,c.jsx)("td",{children:null===s[e]||void 0===s[e]?"-":s[e].toString()},e))},a))})]})})})()})]})]})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac mt-4 grid grid-cols-1",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-header",children:(0,c.jsx)("h2",{className:"jsx-279312e5b42522ac card-title",children:"系統資訊"})}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-body",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac grid grid-cols-2 grid-gap-md",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac stat-card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-icon",children:"\uD83D\uDCBE"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-value",children:"SQL Server"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-label",children:"資料庫類型"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-change positive",children:"運行中"})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac stat-card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-icon",children:"\uD83D\uDD24"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-value",children:"UTF-8"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-label",children:"字符編碼"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-change positive",children:"支援中文"})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac stat-card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-icon",children:"\uD83D\uDCCA"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-value",children:"7"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-label",children:"資料表數量"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-change positive",children:"已建立"})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac stat-card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-icon",children:"\uD83D\uDD17"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-value",children:"success"===a?"Active":"Inactive"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac stat-label",children:"連線狀態"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac "+"stat-change ".concat("success"===a?"positive":"negative"),children:"success"===a?"正常":"異常"})]})]})})]})}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac mt-4 card",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-header",children:(0,c.jsx)("h2",{className:"jsx-279312e5b42522ac card-title",children:"API 端點說明"})}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac card-body",children:(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-panel",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-item alert-low",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-header",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-title",children:"GET /api/database/test"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-level low",children:"GET"})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-content",children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-factory",children:"測試資料庫連線狀態"})})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-item alert-low",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-header",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-title",children:"GET /api/database/table/:tableName"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-level low",children:"GET"})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-content",children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-factory",children:"獲取指定表格的數據"})})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-item alert-low",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-header",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-title",children:"GET /api/factories"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-level low",children:"GET"})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-content",children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-factory",children:"獲取工廠列表數據"})})]}),(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-item alert-low",children:[(0,c.jsxs)("div",{className:"jsx-279312e5b42522ac alert-header",children:[(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-title",children:"GET /api/equipment"}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-level low",children:"GET"})]}),(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-content",children:(0,c.jsx)("div",{className:"jsx-279312e5b42522ac alert-factory",children:"獲取設備清單數據"})})]})]})})]})]}),(0,c.jsx)(l,{id:"279312e5b42522ac",children:"@media(max-width:768px){.mobile-view.jsx-279312e5b42522ac{display:block!important}.desktop-view.jsx-279312e5b42522ac{display:none!important}.grid-cols-2.jsx-279312e5b42522ac{grid-template-columns:repeat(1,1fr)!important}}@media(min-width:769px){.mobile-view.jsx-279312e5b42522ac{display:none!important}.desktop-view.jsx-279312e5b42522ac{display:block!important}.grid-cols-2.jsx-279312e5b42522ac{grid-template-columns:repeat(2,1fr)!important}}@media(min-width:1024px){.grid-cols-2.jsx-279312e5b42522ac{grid-template-columns:repeat(3,1fr)!important}}"})]})}}},function(e){e.O(0,[645,888,774,179],function(){return e(e.s=1688)}),_N_E=e.O()}]);