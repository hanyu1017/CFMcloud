(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{1823:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/factories",function(){return t(6614)}])},3759:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var a=t(7294),c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n=(e,s)=>{let t=(0,a.forwardRef)((t,n)=>{let{color:r="currentColor",size:i=24,strokeWidth:d=2,absoluteStrokeWidth:o,className:m="",children:x,...h}=t;return(0,a.createElement)("svg",{ref:n,...c,width:i,height:i,stroke:r,strokeWidth:o?24*Number(d)/Number(i):d,className:["lucide","lucide-".concat(l(e)),m].join(" "),...h},[...s.map(e=>{let[s,t]=e;return(0,a.createElement)(s,t)}),...Array.isArray(x)?x:[x]])});return t.displayName="".concat(e),t}},2217:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},4270:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},437:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},6611:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])},1163:function(e,s,t){e.exports=t(3079)},6614:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var a=t(5893),c=t(7294),l=t(6725),n=t(3759);let r=(0,n.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),i=(0,n.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),d=(0,n.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var o=t(437);let m=(0,n.Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),x=(0,n.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),h=(0,n.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var u=t(4270),j=t(2217);let p=(0,n.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var y=t(6611);let f=(0,n.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);function N(){let[e,s]=(0,c.useState)([]),[t,n]=(0,c.useState)({}),[N,v]=(0,c.useState)(!0),[g,b]=(0,c.useState)(null),[w,k]=(0,c.useState)(""),[Z,C]=(0,c.useState)("all"),[_,E]=(0,c.useState)("name"),[S,M]=(0,c.useState)(!1),A=async()=>{try{let e=new URLSearchParams;"all"!==Z&&e.append("status",Z),w&&e.append("search",w),e.append("sortBy",_);let t=await fetch("/api/factories?".concat(e));if(!t.ok)throw Error("獲取工廠數據失敗");let a=await t.json();s(Array.isArray(a)?a:[])}catch(e){console.error("獲取工廠數據錯誤:",e),b(e.message)}},L=async()=>{try{let e=await fetch("/api/factories/stats");if(!e.ok)throw Error("獲取統計數據失敗");let s=await e.json();n(s)}catch(e){console.error("獲取統計數據錯誤:",e)}};(0,c.useEffect)(()=>{(async()=>{v(!0),await Promise.all([A(),L()]),v(!1)})()},[]),(0,c.useEffect)(()=>{N||A()},[w,Z,_]);let z=e=>{let{status:s}=e,t={online:{cssClass:"status-online",icon:r,text:"運行中"},offline:{cssClass:"status-offline",icon:i,text:"離線"},maintenance:{cssClass:"status-maintenance",icon:d,text:"維護中"}}[s],c=t.icon;return(0,a.jsxs)("div",{className:"status-badge ".concat(t.cssClass),children:[(0,a.jsx)(c,{className:"w-3 h-3 mr-1"}),t.text]})},P=e=>{let{title:s,value:t,icon:c,trend:l,trendValue:n,color:r="blue"}=e;return(0,a.jsx)("div",{className:"stat-card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:s}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:t}),l&&(0,a.jsxs)("div",{className:"flex items-center mt-2",children:["up"===l?(0,a.jsx)(o.Z,{className:"w-4 h-4 text-green-500 mr-1"}):(0,a.jsx)(m,{className:"w-4 h-4 text-red-500 mr-1"}),(0,a.jsx)("span",{className:"text-xs font-medium ".concat("up"===l?"text-green-600":"text-red-600"),children:n})]})]}),(0,a.jsx)("div",{className:"stat-icon ".concat((e=>{switch(e){case"green":return"stat-icon-success";case"yellow":return"stat-icon-warning";case"red":return"stat-icon-danger";default:return"stat-icon-primary"}})(r)),children:(0,a.jsx)(c,{className:"w-6 h-6"})})]})})},q=e=>{var s,t;let{factory:c}=e;return(0,a.jsxs)("div",{className:"factory-card",children:[(0,a.jsxs)("div",{className:"factory-header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"factory-name",children:c.name}),(0,a.jsxs)("div",{className:"factory-location",children:[(0,a.jsx)(x,{className:"w-4 h-4 mr-1"}),c.location]})]}),(0,a.jsx)(z,{status:c.status})]}),(0,a.jsxs)("div",{className:"factory-metrics",children:[(0,a.jsxs)("div",{className:"metric",children:[(0,a.jsxs)("div",{className:"metric-value ".concat((s=c.efficiency)>=90?"text-success":s>=70?"text-warning":"text-danger"),children:[c.efficiency||0,"%"]}),(0,a.jsx)("div",{className:"metric-label",children:"效率"})]}),(0,a.jsxs)("div",{className:"metric",children:[(0,a.jsx)("div",{className:"metric-value",children:c.employees||0}),(0,a.jsx)("div",{className:"metric-label",children:"員工"})]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"生產率:"}),(0,a.jsxs)("span",{className:"font-medium",children:[c.production_rate||0,"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"耗電量:"}),(0,a.jsxs)("span",{className:"font-medium",children:[c.power_consumption||0," kW"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"警報:"}),(0,a.jsxs)("span",{className:"font-medium ".concat(c.alerts>0?"text-danger":"text-success"),children:[c.alerts||0," 個"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"最後維護:"}),(0,a.jsx)("span",{className:"font-medium",children:(t=c.last_maintenance)?new Date(t).toLocaleDateString("zh-TW"):"未知"})]})]}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{className:"btn btn-primary btn-sm flex-1",children:"詳細信息"}),(0,a.jsx)("button",{className:"btn btn-secondary btn-sm",children:"編輯"})]})})]})};return N?(0,a.jsx)(l.Z,{children:(0,a.jsx)("div",{className:"loading-container",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"spinner mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"載入工廠數據中..."})]})})}):g?(0,a.jsx)(l.Z,{children:(0,a.jsx)("div",{className:"loading-container",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(h,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"載入失敗"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:g}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"重新載入"})]})})}):(0,a.jsxs)(l.Z,{children:[(0,a.jsx)("div",{className:"page-header",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"page-title",children:"工廠管理中心"}),(0,a.jsx)("p",{className:"page-subtitle",children:"監控和管理所有生產基地的運營狀況"})]}),(0,a.jsxs)("button",{onClick:()=>M(!0),className:"btn btn-primary",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"新增工廠"]})]})}),(0,a.jsxs)("div",{className:"grid grid-stats mb-8",children:[(0,a.jsx)(P,{title:"總工廠數",value:t.totalFactories||0,icon:j.Z,color:"blue"}),(0,a.jsx)(P,{title:"運行中",value:t.onlineFactories||0,icon:r,color:"green"}),(0,a.jsx)(P,{title:"總員工",value:(t.totalEmployees||0).toLocaleString(),icon:p,color:"blue"}),(0,a.jsx)(P,{title:"平均效率",value:"".concat(t.averageEfficiency||0,"%"),icon:o.Z,color:"green"}),(0,a.jsx)(P,{title:"總警報",value:t.totalAlerts||0,icon:h,color:"red"}),(0,a.jsx)(P,{title:"總耗電",value:"".concat((t.totalPowerConsumption||0).toLocaleString()," kW"),icon:y.Z,color:"yellow"})]}),(0,a.jsx)("div",{className:"card mb-6",children:(0,a.jsx)("div",{className:"card-body",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"搜索工廠名稱或地址...",value:w,onChange:e=>k(e.target.value),className:"form-input pl-10"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("select",{value:Z,onChange:e=>C(e.target.value),className:"form-select",children:[(0,a.jsx)("option",{value:"all",children:"所有狀態"}),(0,a.jsx)("option",{value:"online",children:"運行中"}),(0,a.jsx)("option",{value:"maintenance",children:"維護中"}),(0,a.jsx)("option",{value:"offline",children:"離線"})]}),(0,a.jsxs)("select",{value:_,onChange:e=>E(e.target.value),className:"form-select",children:[(0,a.jsx)("option",{value:"name",children:"按名稱排序"}),(0,a.jsx)("option",{value:"efficiency",children:"按效率排序"}),(0,a.jsx)("option",{value:"alerts",children:"按警報數排序"})]})]})]})})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("h2",{className:"card-title",children:"工廠列表"}),(0,a.jsx)("p",{className:"card-subtitle",children:e.length>0?"共 ".concat(e.length," 個工廠"):"暫無工廠資料"})]}),(0,a.jsx)("div",{className:"card-body",children:e.length>0?(0,a.jsx)("div",{className:"grid grid-cols-3",style:{gap:"1.5rem"},children:e.map(e=>(0,a.jsx)(q,{factory:e},e.factory_id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(j.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"找不到工廠"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:w||"all"!==Z?"沒有符合篩選條件的工廠":"還沒有任何工廠資料"}),(w||"all"!==Z)&&(0,a.jsx)("button",{onClick:()=>{k(""),C("all")},className:"btn btn-primary",children:"清除篩選"})]})})]}),S&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"新增工廠"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"工廠新增功能開發中..."}),(0,a.jsx)("div",{className:"flex justify-end space-x-3",children:(0,a.jsx)("button",{onClick:()=>M(!1),className:"btn btn-secondary",children:"取消"})})]})})]})}}},function(e){e.O(0,[725,888,774,179],function(){return e(e.s=1823)}),_N_E=e.O()}]);