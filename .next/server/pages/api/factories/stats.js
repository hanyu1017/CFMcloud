"use strict";(()=>{var e={};e.id=11,e.ids=[11],e.modules={5142:e=>{e.exports=require("dotenv")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8678:e=>{e.exports=import("pg")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},228:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{config:()=>f,default:()=>l,routeModule:()=>p});var n=a(1802),r=a(7153),s=a(6249),i=a(1520),c=e([i]);i=(c.then?(await c)():c)[0];let l=(0,s.l)(i,"default"),f=(0,s.l)(i,"config"),p=new n.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/factories/stats",pathname:"/api/factories/stats",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)},6125:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.d(t,{Z:()=>c});var n=a(8678),r=a(5142),s=e([n]);n=(s.then?(await s)():s)[0],r.config();let i=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});i.on("error",e=>{console.error("Unexpected error on idle client",e),process.exit(-1)});let c=i;o()}catch(e){o(e)}})},1520:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{default:()=>s});var n=a(6125),r=e([n]);async function s(e,t){if("GET"!==e.method)return t.setHeader("Allow",["GET"]),t.status(405).json({error:`Method ${e.method} Not Allowed`});try{let e=`
      SELECT 
        COUNT(*) as total_factories,
        COUNT(CASE WHEN status = 'online' THEN 1 END) as online_factories,
        COUNT(CASE WHEN status = 'maintenance' THEN 1 END) as maintenance_factories,
        COUNT(CASE WHEN status = 'offline' THEN 1 END) as offline_factories,
        COALESCE(SUM(employees), 0) as total_employees,
        COALESCE(AVG(efficiency), 0) as average_efficiency,
        COALESCE(SUM(alerts), 0) as total_alerts,
        COALESCE(SUM(power_consumption), 0) as total_power_consumption
      FROM factories
    `,a=(await n.Z.query(e)).rows[0],o={totalFactories:parseInt(a.total_factories),onlineFactories:parseInt(a.online_factories),maintenanceFactories:parseInt(a.maintenance_factories),offlineFactories:parseInt(a.offline_factories),totalEmployees:parseInt(a.total_employees),averageEfficiency:parseFloat(a.average_efficiency).toFixed(1),totalAlerts:parseInt(a.total_alerts),totalPowerConsumption:parseInt(a.total_power_consumption)};t.status(200).json(o)}catch(e){console.error("獲取統計數據錯誤：",e),t.status(500).json({error:"伺服器錯誤",detail:e.message})}}n=(r.then?(await r)():r)[0],o()}catch(e){o(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=228);module.exports=a})();