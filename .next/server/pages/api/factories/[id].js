"use strict";(()=>{var e={};e.id=939,e.ids=[939],e.modules={5142:e=>{e.exports=require("dotenv")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8678:e=>{e.exports=import("pg")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9164:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>E,default:()=>u,routeModule:()=>l});var n=r(1802),a=r(7153),s=r(6249),i=r(9564),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,s.l)(i,"default"),E=(0,s.l)(i,"config"),l=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/factories/[id]",pathname:"/api/factories/[id]",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)},6125:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Z:()=>c});var n=r(8678),a=r(5142),s=e([n]);n=(s.then?(await s)():s)[0],a.config();let i=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});i.on("error",e=>{console.error("Unexpected error on idle client",e),process.exit(-1)});let c=i;o()}catch(e){o(e)}})},9564:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>s});var n=r(6125),a=e([n]);async function s(e,t){let{id:r}=e.query;switch(e.method){case"GET":return await i(e,t,r);case"PUT":return await c(e,t,r);case"DELETE":return await u(e,t,r);default:t.setHeader("Allow",["GET","PUT","DELETE"]),t.status(405).json({error:`Method ${e.method} Not Allowed`})}}async function i(e,t,r){try{let e=await n.Z.query("SELECT * FROM factories WHERE factory_id = $1",[r]);if(0===e.rows.length)return t.status(404).json({error:"工廠不存在"});t.status(200).json(e.rows[0])}catch(e){console.error("獲取工廠錯誤：",e),t.status(500).json({error:"伺服器錯誤",detail:e.message})}}async function c(e,t,r){try{let{name:o,location:a,status:s,employees:i,efficiency:c,power_consumption:u,production_rate:E,alerts:l}=e.body,d=`
      UPDATE factories SET
        name = COALESCE($1, name),
        location = COALESCE($2, location),
        status = COALESCE($3, status),
        employees = COALESCE($4, employees),
        efficiency = COALESCE($5, efficiency),
        power_consumption = COALESCE($6, power_consumption),
        production_rate = COALESCE($7, production_rate),
        alerts = COALESCE($8, alerts),
        updated_at = CURRENT_TIMESTAMP
      WHERE factory_id = $9
      RETURNING *
    `,f=await n.Z.query(d,[o,a,s,i,c,u,E,l,r]);if(0===f.rows.length)return t.status(404).json({error:"工廠不存在"});t.status(200).json(f.rows[0])}catch(e){console.error("更新工廠錯誤：",e),t.status(500).json({error:"伺服器錯誤",detail:e.message})}}async function u(e,t,r){try{let e=await n.Z.query("DELETE FROM factories WHERE factory_id = $1 RETURNING *",[r]);if(0===e.rows.length)return t.status(404).json({error:"工廠不存在"});t.status(200).json({message:"工廠已成功刪除",deleted:e.rows[0]})}catch(e){console.error("刪除工廠錯誤：",e),t.status(500).json({error:"伺服器錯誤",detail:e.message})}}n=(a.then?(await a)():a)[0],o()}catch(e){o(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9164);module.exports=r})();